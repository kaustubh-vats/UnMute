let muteBtn,surround=[];const SURROUNDS_VALS=["left","right","top","bottom"],cssUrl=document.currentScript.getAttribute("data-cssurl"),url=location.hostname;let isFoundElseWhere=!1;const FOUND_MESSAGE="UNMUTE_FOUND",UPDATE_XY_MESSAGE="UNMUTE_UPDATE_TIMER_X",getAttributeToListen=()=>url.includes("meet.google")?"data-is-muted":url.includes("zoom")?"aria-label":void 0,getBtnSelector=()=>url.includes("meet.google")?"[aria-label~='microphone']":url.includes("zoom")?".join-audio-container__btn":void 0,ifMuteBtnExist=()=>null!=muteBtn,isMicDisabled=()=>{if(ifMuteBtnExist()){if(url.includes("meet.google"))return"true"==muteBtn.getAttribute("data-is-muted");if(url.includes("zoom")){let e=muteBtn.getAttribute("aria-label").toLowerCase();return e.includes("join audio")||e.includes("unmute")}}return!1},getColorClass=()=>isMicDisabled()?"muted":"unmuted",getAltClass=e=>"unmuted"===e?"muted":"unmuted",changeMode=()=>{ifMuteBtnExist()&&8===surround.length&&surround.forEach(e=>{let t=e.classList,s=getColorClass(),n=getAltClass(s);t.contains(n)&&(t.remove(n),t.add(s))})},dettachSurroundIfExist=()=>{surround.forEach(e=>{e.remove()})},getBasicSurround=()=>{let e=document.createElement("div");return e.setAttribute("class",`border ${getColorClass()}`),e},removeSurround=()=>{dettachSurroundIfExist(),surround=[]},getCSSUrl=()=>cssUrl||document.querySelector("#unmute__script").getAttribute("data-cssurl"),getPrevX=()=>{let e=document.querySelector("#unmute__script").getAttribute("data-timerx");return"undefined"===e?null:e},getPrevY=()=>{let e=document.querySelector("#unmute__script").getAttribute("data-timery");return"undefined"===e?null:e},removeWrapper=()=>{let e=document.querySelector("unmute-glass");e&&e.remove()};function updateDiv(e,t){if(t){let s=e.reduce((e,t)=>e+t,0)/e.length;t.style.setProperty("--audio-freq",Math.round(100*s)+"px")}}function animate(e,t){let s=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(s);let n=[...s].map(e=>e/128);updateDiv(n,t),t&&t.isConnected&&requestAnimationFrame(()=>animate(e,t))}const attachAudioAnimation=e=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){let s=new AudioContext,n=s.createMediaStreamSource(t),i=s.createAnalyser();i.fftSize=512,n.connect(i),animate(i,e)}).catch(function(e){console.debug("Error accessing microphone:",e)})},checkIfAudioIsPresent=e=>{navigator.permissions.query({name:"microphone"}).then(function(t){"granted"===t.state&&attachAudioAnimation(e)}).catch(function(e){console.debug("Error checking microphone permissions:",e)})},createSurround=()=>{removeWrapper();let e=document.createElement("unmute-glass"),t=e.attachShadow({mode:"closed"}),s=document.createElement("div"),n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href=getCSSUrl(),t.appendChild(n),s.setAttribute("class","unmute__container"),ifMuteBtnExist()&&(removeSurround(),SURROUNDS_VALS.forEach(e=>{let t=getBasicSurround();t.classList.add(e);let n=t.cloneNode();n.classList.add("opacited"),s.appendChild(t),s.appendChild(n),surround.push(t),surround.push(n)}));let i=new Timer(getPrevX(),getPrevY()),r=i.createTimer();s.appendChild(r),t.appendChild(s),checkIfAudioIsPresent(s),document.body.appendChild(e)},init=()=>{if(muteBtn=document.querySelector(getBtnSelector())){createSurround();let e=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&e.attributeName===getAttributeToListen()&&changeMode()})}),t={attributes:!0,attributeFilter:[getAttributeToListen()]};e.observe(muteBtn,t)}else removeSurround()};window.addEventListener("message",e=>{try{let t=JSON.parse(e.data);t.message===FOUND_MESSAGE&&e.source!==window&&(isFoundElseWhere=t.value)}catch(s){}});const sendMessageForIsFound=e=>{let t={message:FOUND_MESSAGE,value:e};sendMessage(t)},sendMessage=e=>{window.postMessage(JSON.stringify(e),"*"),window.top.postMessage(JSON.stringify(e),"*")},handleMessage=e=>{!e&&muteBtn?sendMessageForIsFound(!1):e&&sendMessageForIsFound(!0)},domObserver=new MutationObserver(()=>{if(isFoundElseWhere||muteBtn&&muteBtn.isConnected)return;let e=document.querySelector(getBtnSelector());handleMessage(e),e!==muteBtn&&init()});class Timer{constructor(e,t){this.x=e??50,this.y=t??50,this.minutesElement,this.secondsElement,this.minutes=0,this.seconds=0,this.timerInterval,this.dragStartX=0,this.dragStartY=0}createTimer=()=>{let e=document.createElement("div");e.classList.add("timer-container");let t=document.createElement("div");t.classList.add("timer"),this.minutesElement=document.createElement("span"),this.minutesElement.id="minutes",this.minutesElement.textContent="00";let s=document.createTextNode(":");this.secondsElement=document.createElement("span"),this.secondsElement.id="seconds",this.secondsElement.textContent="00",t.appendChild(this.minutesElement),t.appendChild(s),t.appendChild(this.secondsElement);let n=document.createElement("div");n.classList.add("controls");let i=document.createElement("button");i.id="startBtn",i.className="resume";let r=document.createElement("button");function a(t){t.dataTransfer.setData("text/plain",t.target.id),t.dataTransfer.dropEffect="move";let s=t.clientX,n=t.clientY,i=e.getBoundingClientRect();this.dragStartX=s-i.x,this.dragStartY=n-i.y}function d(t){let s=e.getBoundingClientRect(),n=t.clientX,i=t.clientY,r=n-this.dragStartX,a=i-this.dragStartY;r<0&&(r=0),a<0&&(a=0),r>document.documentElement.clientWidth-s.width&&(r=document.documentElement.clientWidth-s.width),a>document.documentElement.clientHeight-s.height&&(a=document.documentElement.clientHeight-s.height),this.setTimerXAndY(e,r,a),this.updateScriptAndExtension(r,a)}return r.id="resetBtn",r.className="resetIcon",e.appendChild(i),e.appendChild(t),e.appendChild(r),e.setAttribute("draggable","true"),e.addEventListener("dragstart",a.bind(this)),e.addEventListener("dragend",d.bind(this)),i.addEventListener("click",(function(){this.timerInterval?(clearInterval(this.timerInterval),this.timerInterval=null,i.className="resume"):(this.timerInterval=setInterval(this.updateTimer.bind(this),1e3),i.className="play")}).bind(this)),r.addEventListener("click",(function(){clearInterval(this.timerInterval),this.timerInterval=null,this.minutes=0,this.seconds=0,this.updateTimerDisplay(),i.className="resume"}).bind(this)),this.setTimerXAndY(e,this.x,this.y),e};updateScriptAndExtension(e,t){let s=document.querySelector("#unmute__script");s&&(s.setAttribute("data-timerx",e),s.setAttribute("data-timery",t)),sendMessage({message:"UNMUTE_UPDATE_TIMER_X",value:{x:e,y:t}})}setTimerXAndY(e,t,s){e.style.setProperty("--timer-x",`${t}px`),e.style.setProperty("--timer-y",`${s}px`)}updateTimer(){this.seconds++,60===this.seconds&&(this.minutes++,this.seconds=0),this.updateTimerDisplay()}updateTimerDisplay(){this.minutesElement&&this.secondsElement&&(this.minutesElement.textContent=this.padZero(this.minutes),this.secondsElement.textContent=this.padZero(this.seconds))}padZero(e){return e<10?`0${e}`:e}}window.customElements.define("unmute-glass",class extends HTMLElement{constructor(){super()}}),domObserver.observe(document.body,{subtree:!0,childList:!0}),init();